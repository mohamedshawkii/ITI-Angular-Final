<div class="brand-detail-page">
  <!-- Brand Header -->
  <div class="brand-hero">
    <div class="brand-cover">
      <img
        [src]="EUrl + brand.image"
        alt="{{ brand.name }} Cover Image"
        class="cover-image"
      />
    </div>

    <div class="container">
      <div class="hero-content">
        <div class="brand-info">
          <div class="brand-logo">
            <img
              [src]="EUrl + brand.image"
              alt="{{ brand.name }} Logo"
              class="logo-image"
            />
          </div>
          <div class="brand-details">
            <h1 class="brand-name">{{ brand.name }}</h1>
            <div class="brand-stats">
              <div class="stat-item">
                <span class="stat-description">{{ brand.description }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="brand-actions">
          <button class="btn btn-outline" (click)="shareBrand()">Share</button>
        </div>
      </div>
    </div>
  </div>

  <div class="products-section">
    <div class="container">
      <!-- عرض للمالك -->
      <div *ngIf="DisplayBasedOnRole('BrandOwner')">
        <div class="section-header">
          <h2 class="section-title">Our Products</h2>
          <button class="btn btn-success" (click)="openProductForm()">
            Add Product
          </button>
        </div>

        <div class="products-grid">
          <div class="product-card" *ngFor="let product of products">
            <div class="product-info">
              <h3 class="product-name">{{ product.name }}</h3>
              <p class="product-description">
                {{ product.description | slice : 0 : 60 }}...
              </p>
              <div class="product-image">
                <img
                  [src]="EUrl + product.image"
                  alt="{{ product.name }}"
                  class="img-fluid"
                />
              </div>
              <div class="product-price">{{ product.price }} EGP</div>
              <div class="product-actions">
                <button class="btn btn-warning" (click)="openEditForm(product)">
                  <i class="fa fa-edit"></i> Edit
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- مودال إضافة/تعديل المنتج -->
      <div class="modal-overlay" *ngIf="showProductForm">
        <div class="modal-content">
          <div class="modal-header">
            <h2>{{ selectedProduct ? "Edit Product" : "Add New Product" }}</h2>
            <button class="close-btn" (click)="closeProductForm()">
              &times;
            </button>
          </div>

          <div class="modal-body">
            <form [formGroup]="productForm" (ngSubmit)="SaveProduct()">
              <div class="form-group">
                <label>Product Name</label>
                <input
                  type="text"
                  class="form-control"
                  formControlName="name"
                />
              </div>

              <div class="form-group">
                <label>Price</label>
                <input
                  type="number"
                  class="form-control"
                  formControlName="price"
                />
              </div>

              <div class="form-group">
                <label>Description</label>
                <textarea
                  class="form-control"
                  rows="3"
                  formControlName="description"
                ></textarea>
              </div>

              <div class="form-group">
                <label>Quantity</label>
                <input
                  type="number"
                  class="form-control"
                  formControlName="quantity"
                />
              </div>

              <div class="form-group">
                <label>Image</label>
                <input
                  type="file"
                  class="form-control"
                  (change)="onImageSelected($event)"
                />
              </div>

              <div class="form-actions mt-3 d-flex justify-content-between">
                <button type="submit" class="btn btn-success">
                  {{ selectedProduct ? "Update Product" : "Add Product" }}
                </button>
                <button
                  type="button"
                  class="btn btn-secondary"
                  (click)="closeProductForm()"
                >
                  Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- عرض للعميل (غير المالك) -->
      <div *ngIf="!DisplayBasedOnRole('BrandOwner')">
        <div class="products-grid">
          <div class="product-card" *ngFor="let product of products">
            <div class="product-info">
              <h3 class="product-name">{{ product.name }}</h3>
              <p class="product-description">
                {{ product.description | slice : 0 : 60 }}...
              </p>
              <div class="product-image">
                <img
                  [src]="EUrl + product.image"
                  alt="{{ product.name }}"
                  class="img-fluid"
                />
              </div>
              <div class="product-price">{{ product.price }} EGP</div>

              <div class="product-actions">
                <button class="btn btn-primary" (click)="addToCart(product)">
                  Add to Cart
                </button>
                <button
                  class="btn btn-secondary"
                  (click)="removeFromCart(product.id)"
                >
                  Remove
                </button>
                <button
                  class="btn btn-primary"
                  (click)="selectProduct(product); openReviewForm()"
                >
                  إضافة تقييم
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- مودال إضافة تقييم -->
        <div class="modal-overlay" *ngIf="showReviewForm">
          <div class="modal-content">
            <div class="modal-header">
              <h2>أضف تقييمك</h2>
              <button class="close-btn" (click)="closeReviewForm()">
                &times;
              </button>
            </div>

            <div class="modal-body">
              <form
                #reviewForm="ngForm"
                (ngSubmit)="AddReviewProduct(reviewForm)"
              >
                <div class="form-group">
                  <label for="comment">التعليق</label>
                  <textarea
                    id="comment"
                    name="comment"
                    class="form-control"
                    [(ngModel)]="newReview.comment"
                    rows="3"
                    required
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="rating">التقييم</label>
                  <select
                    id="rating"
                    name="rating"
                    class="form-control"
                    [(ngModel)]="newReview.rating"
                    required
                  >
                    <option *ngFor="let r of [1, 2, 3, 4, 5]" [value]="r">
                      {{ r }}
                    </option>
                  </select>
                </div>

                <div class="form-actions">
                  <button type="submit" class="btn btn-success">
                    Add Review
                  </button>
                  <button
                    type="button"
                    class="btn btn-secondary"
                    (click)="closeReviewForm()"
                  >
                    إلغاء
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
